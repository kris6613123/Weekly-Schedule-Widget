<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css">
    
  <title>시간표</title>

  </head>
  <body>
    <div id = "t"><strong>2021학년도 1학기 시간표</strong> <i class="bi bi-calendar-check"></i></div>

    <div class="d-flex align-items-center">
      <div class = "m-auto">
        <input type="text" class="form control" id="newClassTitle" placeholder="과목명" size = '27'>
        <select name="day" id="newClassDay" style="height:30px">
          <option value="월">월</option>
          <option value="화">화</option>
          <option value="수">수</option>
          <option value="목">목</option>
          <option value="금">금</option>
        </select>
        요일
        <input type="number" value="9" min='9' max='21' step='1'  style="width: 45px;" class="form control me-1" id="StartHour">:
        <input type="number" value="00" min='00' max='59' step='1'  style="width: 45px;" class="form control me-1" id="StartMinute">~
        <input type="number" value="10" min='9' max='22' step='1'  style="width: 45px;" class="form control me-1" id="EndHour">:
        <input type="number" value="15" min='00' max='59' step='1'  style="width: 45px;" class="form control me-1" id="EndMinute">
        <button type="button" id="addClass" class="btn btn-sm btn-primary ms-1 text-nowrap mb-1"><i class="bi bi-plus"></i>Add</button>
      </div>
    </div>
    <div class="timetable">
      <div class="tablehead">
        <table class="tablehead" height="50" style="color: #121212">
          <tr>
            <th class="time"></th>
            <th>월</th>
            <th>화</th>
            <th>수</th>
            <th>목</th>
            <th>금</th>
          </tr>
        </table>
      </div>    
  
      <div class="tablebody">
        <table class="tablebody">
          <tbody>
            <tr>
              <th>
                <div class="hours">
                  <div class="hour">오전 9시</div>
                  <div class="hour">오전 10시</div>
                  <div class="hour">오전 11시</div>
                  <div class="hour">오후 12시</div>
                  <div class="hour">오후 1시</div>
                  <div class="hour">오후 2시</div>
                  <div class="hour">오후 3시</div>
                  <div class="hour">오후 4시</div>
                  <div class="hour">오후 5시</div>
                  <div class="hour">오후 6시</div>
                  <div class="hour">오후 7시</div>
                  <div class="hour">오후 8시</div>
                  <div class="hour">오후 9시</div>
                </div>
              </th>
              <td>
                <div class="cols" id="월">
                 <!--  <div class="subject color2" style="position: absolute; top: 60px; height: 151px;"></div>-->
                </div>
                <div class="grids">
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                </div>
              </td>
              <td>
                <div class="cols" id="화">
                  <!--<div class="subject color2" style="position: absolute; top: 210px; height: 151px;"></div>-->
                </div>
                <div class="grids">
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                </div>
              </td>
              <td>
                <div class="cols" id="수">
                </div>
                <div class="grids">
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                </div>
              </td>
              <td>
                <div class="cols" id="목">
                </div>
                <div class="grids">
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                </div>
              </td>
              <td>
                <div class="cols" id="금">
                </div>
                <div class="grids">
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                  <div class="grid"></div>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>


    <div class="mx-auto" style="width: 700px;">
      <div class="input-group input-group-sm">
        <span class="input-group-text" id="inputGroup-sizing-sm">Note</span>
        <input type="text" id="form-control" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-sm">
        <button type="button" id="btn btn-primary ms-1 text-nowrap" class="btn btn-primary ms-1 text-nowrap"><i class="bi bi-plus"></i></button>
      </div>
    <div class = "d-flex align-items-center">
      <span id="me-auto" class="me-auto"></span> 
        <button id="btn btn-sm btn-danger"class="btn btn-sm btn-danger"><i class="bi bi-x"></i></button>
      </div>
    </div>

  </body>
  <script>

    let classes = [];
    let notes = [];

    let addClassBtn = document.querySelector("#addClass");
    addClassBtn.addEventListener("click", addTable);
    
    function addTable (){
      // 1. read input
      let _title = document.querySelector("#newClassTitle");
      let _day = document.querySelector("#newClassDay");
      let _sHour = document.querySelector("#StartHour");
      let _sMinute = document.querySelector("#StartMinute");
      let _eHour = document.querySelector("#EndHour");
      let _eMinute = document.querySelector("#EndMinute");

      let title = _title.value;
      let day = _day.value;
      let sHour = _sHour.value;
      let sMinute = _sMinute.value;
      let eHour = _eHour.value;
      let eMinute = _eMinute.value;

      // 2. create class object
      let _class = {
        title: title,
        day: day,
        sHour: Number(sHour),
        sMinute: Number(sMinute),
        eHour: Number(eHour),
        eMinute: Number(eMinute)
      };

      console.log(_class);
      // 2.5 exception handling
      if (!valid_check(_class))
        return;
      


      // 3. Append to class list
      classes.push(_class);
      saveClasses();

      // 4. Create new class item and attach it to time-table
      addToTable(_class);

      // 5. Clear the input
      _title.value = "";
      _day.value = "월";
      _sHour.value = "9";
      _sMinute.value = "00";
      _eHour.value = "10";
      _eMinute.value = "15";
    }

    function valid_check(_class){
      if(_class.title.length == 0){
        alert("과목명을 입력해주세요.");
        return false;
      } 
      if(_class.sHour < 9 || _class.sHour > 21 || _class.sMinute < 0 || _class.sMinute > 59 || _class.eHour < 9 || _class.eHour > 22 || _class.eMinute < 0 || _class.eMinute > 59){
        alert("적당한 시간을 입력해 주세요.");
        return false;
      }
      if(_class.eHour == 22 && _class.eMinute != 0){
        alert("종료시간은 22시 00분까지만 입력 가능합니다.");
        return false;
      }

      _classStart = _class.sHour * 60 + _class.sMinute;
      _classEnd = _class.eHour * 60 + _class.eMinute;
      if(_classStart >= _classEnd){
        alert("시작시간은 종료시간보다 빨라야 합니다.");
        return false;
        } 

      for(var i in classes){
        if(classes[i].day === _class.day){
          iStart = classes[i].sHour * 60 + classes[i].sMinute;
          iEnd = classes[i].eHour * 60 + classes[i].eMinute;
          console.log(iStart);
          console.log(iEnd);
          console.log(_classStart);
          if(iStart <= _classStart && _classStart < iEnd){
            alert("다른 수업과 시간이 겹칩니다.");
            return false;
          }
          if(iStart < _classEnd && _classEnd <= iEnd){
            alert("다른 수업과 시간이 겹칩니다.");
            return false;
          }
          if(iStart > _classStart && iEnd < _classEnd){
            alert("다른 수업과 시간이 겹칩니다.");
            return false;
          }
        }
      }
      return true;
    }

    function saveClasses() {
      localStorage.setItem("classes", JSON.stringify(classes));
    }
    window.addEventListener("load", () => {
        loadClasses();
    });
    function loadClasses() {
      let lastClasses = localStorage.getItem("classes");
      if (!lastClasses) return;
      classes = JSON.parse(lastClasses);
      classes.forEach(t => {
        addToTable(t);
      });
    }



    function addToTable(_class){
      let div = document.createElement("div");
      div.className = "subject color1 d-flex align-items-center";
      
      _classStart = _class.sHour * 60 + _class.sMinute;
      console.log(_classStart);
      _classEnd = _class.eHour * 60 + _class.eMinute;
      _classHeight = _classEnd - _classStart + 1;
      _classTop = _classStart - 540;

      div.style.setProperty('position', 'absolute');
      div.style.setProperty('top', _classTop + 'px');
      div.style.setProperty('height', _classHeight + 'px');

      // TO-do : 내부 구성요소 추가 & 삭제버튼 구현
      let span = document.createElement("span");
      span.className = "me-auto ms-2";

      span.textContent = _class.title;
      div.appendChild(span);

      let buttonRemove = document.createElement("button");
      buttonRemove.className = "btn btn-sm btn-danger me-2";
      buttonRemove.innerHTML = '<i class="bi bi-x"></i>';
      div.appendChild(buttonRemove);
      buttonRemove.addEventListener("click", () => {
        div.remove();
        classes = classes.filter(t => t !== _class);
        saveClasses();
      });
      
      // 시간표 화면에 추가
      let col = document.querySelector("#"+_class.day);
      col.appendChild(div);
    }


let inputBox = document.getElementById('form-control');
let addButton = document.getElementById('btn btn-primary ms-1 text-nowrap');
let ToDoList = document.getElementById('me-auto');
let removelist = document.getElementById('btn btn-sm btn-danger');
addButton.addEventListener('click', function(){
    var list = document.createElement('li')
    list.innerText = inputBox.value;
    ToDoList.appendChild(list);
    inputBox.value = "";
    list.addEventListener('click', function(){
        list.style.textDecoration = "line-through";
    })
    removelist.addEventListener('click', function(){
        ToDoList.removeChild(list);
    })
})


  </script>
</html>
